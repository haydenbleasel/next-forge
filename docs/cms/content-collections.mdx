---
title: Switch to Content Collections
description: How to switch to Content Collections.
---

It's possible to switch to [Content Collections](https://www.content-collections.dev/) to generate type-safe data collections from MDX files. This approach provides a structured way to manage blog posts while maintaining full type safety throughout your application.

## 1. Swap out the required dependencies

Remove the existing dependencies...

```sh Terminal
pnpm remove basehub concurrently --filter web
```

... and install the new dependencies...

```sh Terminal
pnpm add @content-collections/mdx
pnpm add -D @content-collections/cli @content-collections/core @content-collections/next
```

## 2. Update the prebuild script

Update the `package.json` file to replace the `basehub` scripts with the `content-collections` script:

```json apps/web/package.json {2,3}
"scripts": {
  "dev": "next dev -p 3001 --turbopack",
  "prebuild": "content-collections build"
}
```

<Note>The prebuild script exists to use the Content Collections CLI directly. The files are cached and not rebuilt in the Next.js build process. This is a workaround for [this issue](https://github.com/sdorra/content-collections/issues/214).</Note>

## 3. Update the `.gitignore` file

Update the `.gitignore` file to ignore the `.content-collections` directory:

```git apps/web/.gitignore {1-2}
# content-collections
.content-collections
```

## 4. Update the `next.config.ts` file

Update the `next.config.ts` file to include the content collections:

```ts apps/web/next.config.ts {1,5}
import { withContentCollections } from '@content-collections/next';

// ...

export default withContentCollections(nextConfig);
```

## 5. Update the `tsconfig.json` file

Update the `tsconfig.json` file to include content collections:

```json apps/web/tsconfig.json {4}
{
  "compilerOptions": {
    "paths": {
      "content-collections": ["./.content-collections/generated"]
    }
  }
}
```

## 6. Create the `content-collections.ts` file

```ts apps/web/content-collections.ts
import { defineCollection, defineConfig } from '@content-collections/core';
import { compileMDX } from '@content-collections/mdx';

const posts = defineCollection({
  name: 'posts',
  directory: 'content/blog',
  include: '**/*.mdx',
  schema: (z) => ({
    title: z.string(),
    description: z.string(),
    date: z.string(),
    image: z.string(),
    authors: z.array(z.string()),
    tags: z.array(z.string()),
  }),
  transform: async (page, context) => {
    const body = await context.cache(page.content, async () =>
      compileMDX(context, page)
    );

    return {
      ...page,
      body,
      date: new Date(page.date),
      slug: page._meta.path,
    };
  },
});

const legals = defineCollection({
  name: 'legal',
  directory: 'content/legal',
  include: '**/*.mdx',
  schema: (z) => ({
    title: z.string(),
    description: z.string(),
    date: z.string(),
  }),
  transform: async (page, context) => {
    const body = await context.cache(page.content, async () =>
      compileMDX(context, page)
    );

    return {
      ...page,
      body,
      date: new Date(page.date),
      slug: page._meta.path,
    };
  },
});

export default defineConfig({
  collections: [posts, legals],
});
```

## 7. Bonus features

### Fumadocs MDX Plugins

You can use the [Fumadocs](/documentation/fumadocs) MDX plugins to enhance your MDX content.

```ts {1-6,8-13,20-23}
import {
  type RehypeCodeOptions,
  rehypeCode,
  remarkGfm,
  remarkHeading,
} from 'fumadocs-core/mdx-plugins';

const rehypeCodeOptions: RehypeCodeOptions = {
  themes: {
    light: 'catppuccin-mocha',
    dark: 'catppuccin-mocha',
  },
};

const posts = defineCollection({
  // ...
  transform: async (page, context) => {
    // ...
    const body = await context.cache(page.content, async () =>
      compileMDX(context, page, {
        remarkPlugins: [remarkGfm, remarkHeading],
        rehypePlugins: [[rehypeCode, rehypeCodeOptions]],
      })
    );

    // ...
  },
});
```

### Reading Time

You can calculate reading time for your collection by adding a transform function.

```ts {1,10}
import readingTime from 'reading-time';

const posts = defineCollection({
  // ...
  transform: async (page, context) => {
    // ...

    return {
      // ...
      readingTime: readingTime(page.content).text,
    };
  },
});
```

### Low-Quality Image Placeholder (LQIP)

You can generate a low-quality image placeholder for your collection by adding a transform function.

```ts {1,8-19,23,24}
import { sqip } from 'sqip';

const posts = defineCollection({
  // ...
  transform: async (page, context) => {
    // ...

    const blur = await context.cache(page._meta.path, async () =>
      sqip({
        input: `./public/${page.image}`,
        plugins: [
          'sqip-plugin-primitive',
          'sqip-plugin-svgo',
          'sqip-plugin-data-uri',
        ],
      })
    );

    const result = Array.isArray(blur) ? blur[0] : blur;

    return {
      // ...
      image: page.image,
      imageBlur: result.metadata.dataURIBase64 as string,
    };
  },
});
```

-----

## Creating blog posts

To create a new blog post, add a new MDX file to the `apps/web/content/blog` directory. The file name will be used as the slug for the blog post and the frontmatter will be used to generate the blog post page. For example:

```mdx apps/web/content/blog/my-first-post.mdx
---
title: 'My First Post'
description: 'This is my first blog post'
date: 2024-10-23
image: /blog/my-first-post.png
---
```

The same concept applies to the `legal` collection, which is used to generate the legal policy pages. Also, the `image` field is the path relative to the app's root `public` directory.

## Creating a collection

To create a new collection, you'll need to define it in the `content-collections.ts` file in the web directory. For example, here's how you can define a simple new collection called `docs`:

```ts apps/web/content-collections.ts {3-7, 10}
import { defineCollection } from '@content-collections/core';

const docs = defineCollection({
  name: 'docs',
  directory: 'content/docs',
  include: '**/*.mdx',
});

export default defineConfig({
  collections: [posts, legals, docs],
});
```
